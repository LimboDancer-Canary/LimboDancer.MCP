**PR-5: Operator Console (Blazor Server, read-only)**. It’s a drop-in Blazor Server app with three pages:

* **/sessions** – lists sessions and shows their messages (EF Core / Postgres)
* **/memory** – queries Azure AI Search with simple filters
* **/graph** – lists vertices by label and shows out-edges (Cosmos Gremlin)

Everything is *read-only* for now and should render tables on first run.

---

# Project layout

```
src/
  LimboDancer.MCP.BlazorConsole/
    LimboDancer.MCP.BlazorConsole.csproj
    Program.cs
    appsettings.Development.json
    _Imports.razor
    App.razor
    Pages/
      _Host.cshtml
      Index.razor
      Sessions.razor
      Memory.razor
      Graph.razor
    Shared/
      MainLayout.razor
      NavMenu.razor
      NavLinkItem.razor
      Footer.razor
    wwwroot/
      css/site.css
```

---

## src/LimboDancer.MCP.BlazorConsole/LimboDancer.MCP.BlazorConsole.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk.Web">
  <PropertyGroup>
    <TargetFramework>net9.0</TargetFramework>
    <Nullable>enable</Nullable>
    <ImplicitUsings>enable</ImplicitUsings>
  </PropertyGroup>

  <ItemGroup>
    <PackageReference Include="Microsoft.AspNetCore.Components.Web" Version="9.0.0" />
    <PackageReference Include="Azure.Search.Documents" Version="11.6.1" />
    <PackageReference Include="Gremlin.Net" Version="3.7.2" />
    <PackageReference Include="Microsoft.EntityFrameworkCore" Version="9.0.0" />
  </ItemGroup>

  <ItemGroup>
    <ProjectReference Include="..\LimboDancer.MCP.Storage\LimboDancer.MCP.Storage.csproj" />
    <ProjectReference Include="..\LimboDancer.MCP.Vector.AzureSearch\LimboDancer.MCP.Vector.AzureSearch.csproj" />
    <ProjectReference Include="..\LimboDancer.MCP.Graph.CosmosGremlin\LimboDancer.MCP.Graph.CosmosGremlin.csproj" />
  </ItemGroup>
</Project>
```

---

## src/LimboDancer.MCP.BlazorConsole/Program.cs

```csharp
using Azure;
using Azure.Search.Documents;
using Azure.Search.Documents.Indexes;
using LimboDancer.MCP.Graph.CosmosGremlin;
using LimboDancer.MCP.Storage;
using Microsoft.EntityFrameworkCore;

var builder = WebApplication.CreateBuilder(args);

// Config
var cfg = builder.Configuration
    .AddJsonFile("appsettings.json", optional: true)
    .AddJsonFile("appsettings.Development.json", optional: true)
    .AddEnvironmentVariables()
    .Build();

// Blazor
builder.Services.AddRazorPages();
builder.Services.AddServerSideBlazor();

// EF Core — use factory for Blazor Server safety
builder.Services.AddDbContextFactory<ChatDbContext>(opt =>
{
    var cs = cfg["Persistence:ConnectionString"]
             ?? "Host=localhost;Port=5432;Database=limbodancer_dev;Username=postgres;Password=postgres";
    opt.UseNpgsql(cs);
});

// Azure AI Search clients
builder.Services.AddSingleton<SearchIndexClient>(_ =>
{
    var endpoint = new Uri(cfg["Search:Endpoint"] ?? "https://example.search.windows.net");
    var key = new AzureKeyCredential(cfg["Search:ApiKey"] ?? "replace-me");
    return new SearchIndexClient(endpoint, key);
});
builder.Services.AddSingleton<SearchClient>(_ =>
{
    var endpoint = new Uri(cfg["Search:Endpoint"] ?? "https://example.search.windows.net");
    var key = new AzureKeyCredential(cfg["Search:ApiKey"] ?? "replace-me");
    var index = cfg["Search:Index"] ?? "ldm-memory";
    return new SearchClient(endpoint, index, key);
});

// Cosmos Gremlin
builder.Services.AddCosmosGremlin(builder.Configuration, sectionName: "CosmosGremlin");

var app = builder.Build();

if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Error");
}

app.UseStaticFiles();
app.UseRouting();

app.MapBlazorHub();
app.MapFallbackToPage("/_Host");

app.Run();
```

---

## src/LimboDancer.MCP.BlazorConsole/appsettings.Development.json

```json
{
  "Persistence": {
    "ConnectionString": "Host=localhost;Port=5432;Database=limbodancer_dev;Username=postgres;Password=postgres"
  },
  "Search": {
    "Endpoint": "https://<your-service>.search.windows.net",
    "ApiKey": "<admin-key>",
    "Index": "ldm-memory"
  },
  "CosmosGremlin": {
    "Host": "<account>.gremlin.cosmos.azure.com",
    "Port": 443,
    "EnableSsl": true,
    "Database": "limbodancer",
    "Graph": "history_memory_graph",
    "AuthKey": "<primary-key>",
    "ConnectionPoolSize": 8,
    "Serializer": "GraphSON2"
  }
}
```

---

## src/LimboDancer.MCP.BlazorConsole/\_Imports.razor

```razor
@using System.Net.Http
@using Microsoft.AspNetCore.Components
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.JSInterop
@using LimboDancer.MCP.Storage
@using LimboDancer.MCP.Vector.AzureSearch
@using LimboDancer.MCP.Graph.CosmosGremlin
@using Azure.Search.Documents
@using Azure.Search.Documents.Models
@using Azure.Search.Documents.Indexes
```

---

## src/LimboDancer.MCP.BlazorConsole/App.razor

```razor
<Router AppAssembly="@typeof(App).Assembly">
    <Found Context="routeData">
        <LayoutView Layout="@typeof(Shared.MainLayout)" RouteData="@routeData" />
    </Found>
    <NotFound>
        <LayoutView Layout="@typeof(Shared.MainLayout)">
            <p class="m-4">Sorry, there's nothing at this address.</p>
        </LayoutView>
    </NotFound>
</Router>

@code { }
```

---

## src/LimboDancer.MCP.BlazorConsole/Pages/\_Host.cshtml

```cshtml
@page "/"
@namespace LimboDancer.MCP.BlazorConsole.Pages
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>LimboDancer Operator Console</title>
    <base href="~/" />
    <link rel="stylesheet" href="css/site.css" />
</head>
<body>
    <app>
        <component type="typeof(LimboDancer.MCP.BlazorConsole.App)" render-mode="ServerPrerendered" />
    </app>

    <script src="_framework/blazor.server.js"></script>
</body>
</html>
```

---

## src/LimboDancer.MCP.BlazorConsole/Pages/Index.razor

```razor
@page "/"

<h3>Operator Console</h3>

<p>Use the navigation on the left:</p>
<ul>
    <li><NavLink href="/sessions">Sessions</NavLink> – sessions &amp; messages (read-only)</li>
    <li><NavLink href="/memory">Memory</NavLink> – Azure AI Search (read-only)</li>
    <li><NavLink href="/graph">Graph</NavLink> – Cosmos Gremlin (read-only)</li>
</ul>
```

---

## src/LimboDancer.MCP.BlazorConsole/Pages/Sessions.razor

```razor
@page "/sessions"
@inject IDbContextFactory<ChatDbContext> DbFactory

<h3>Sessions</h3>

<div class="grid">
    <div class="col">
        <h4>Recent Sessions</h4>
        <button class="btn" @onclick="LoadSessionsAsync">Reload</button>
        <table class="grid-table">
            <thead>
                <tr>
                    <th>Id</th>
                    <th>User</th>
                    <th>Created</th>
                    <th>Messages</th>
                </tr>
            </thead>
            <tbody>
                @if (sessions is null)
                {
                    <tr><td colspan="4">Loading…</td></tr>
                }
                else if (sessions.Count == 0)
                {
                    <tr><td colspan="4">No sessions.</td></tr>
                }
                else
                {
                    @foreach (var s in sessions)
                    {
                        <tr class="rowlink @(s.Id == selectedSessionId ? "active" : "")"
                            @onclick="() => SelectSessionAsync(s.Id)">
                            <td>@s.Id</td>
                            <td>@s.UserId</td>
                            <td>@s.CreatedAt.ToString("u")</td>
                            <td>@(s.Messages?.Count ?? 0)</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="col">
        <h4>Messages (@selectedSessionId)</h4>
        <table class="grid-table">
            <thead>
                <tr>
                    <th>When (UTC)</th>
                    <th>Role</th>
                    <th>Content</th>
                </tr>
            </thead>
            <tbody>
            @if (messages is null)
            {
                <tr><td colspan="3">Select a session.</td></tr>
            }
            else if (messages.Count == 0)
            {
                <tr><td colspan="3">No messages.</td></tr>
            }
            else
            {
                @foreach (var m in messages)
                {
                    <tr>
                        <td>@m.CreatedAt.ToString("u")</td>
                        <td>@m.Role</td>
                        <td>@(m.Content?.Length > 200 ? m.Content[..200] + "…" : m.Content)</td>
                    </tr>
                }
            }
            </tbody>
        </table>
    </div>
</div>

@code {
    private List<Session>? sessions;
    private Guid? selectedSessionId;
    private List<Message>? messages;

    protected override async Task OnInitializedAsync()
    {
        await LoadSessionsAsync();
    }

    private async Task LoadSessionsAsync()
    {
        using var db = await DbFactory.CreateDbContextAsync();
        sessions = await db.Sessions
            .AsNoTracking()
            .OrderByDescending(s => s.CreatedAt)
            .Take(100)
            .Select(s => new Session
            {
                Id = s.Id,
                UserId = s.UserId,
                CreatedAt = s.CreatedAt,
                Messages = s.Messages
            })
            .ToListAsync();

        // messages count eager-load (lightweight)
        foreach (var s in sessions)
        {
            s.Messages = await db.Messages.AsNoTracking().Where(m => m.SessionId == s.Id).ToListAsync();
        }
    }

    private async Task SelectSessionAsync(Guid id)
    {
        selectedSessionId = id;
        using var db = await DbFactory.CreateDbContextAsync();
        messages = await db.Messages
            .AsNoTracking()
            .Where(m => m.SessionId == id)
            .OrderBy(m => m.CreatedAt)
            .Take(1000)
            .ToListAsync();
    }
}
```

---

## src/LimboDancer.MCP.BlazorConsole/Pages/Memory.razor

```razor
@page "/memory"
@inject SearchClient Search

<h3>Vector Memory (Azure AI Search)</h3>

<div class="searchpanel">
    <input class="text" @bind="query" placeholder="Query text…" />
    <input class="text" @bind="tag" placeholder="Filter tag (equals) e.g. kind:vector" />
    <input class="text" @bind="externalId" placeholder="Filter ExternalId (equals)" />
    <button class="btn" @onclick="DoSearchAsync">Search</button>
</div>

@if (busy)
{
    <p>Searching…</p>
}
else if (results is null)
{
    <p>Enter a query to search.</p>
}
else
{
    <table class="grid-table">
        <thead>
            <tr>
                <th>Score</th>
                <th>Id</th>
                <th>ExternalId</th>
                <th>Tags</th>
                <th>Preview</th>
            </tr>
        </thead>
        <tbody>
        @if (results.Count == 0)
        {
            <tr><td colspan="5">No results.</td></tr>
        }
        else
        {
            @foreach (var r in results)
            {
                <tr>
                    <td>@r.Score.ToString("F3")</td>
                    <td>@r.Doc.Id</td>
                    <td>@r.Doc.ExternalId</td>
                    <td>@(r.Doc.Tags is null ? "" : string.Join(", ", r.Doc.Tags))</td>
                    <td>@(r.Doc.Content?.Length > 180 ? r.Doc.Content[..180] + "…" : r.Doc.Content)</td>
                </tr>
            }
        }
        </tbody>
    </table>
}

@code {
    private string? query;
    private string? tag;
    private string? externalId;
    private bool busy;
    private List<(MemoryDoc Doc, double Score)>? results;

    private async Task DoSearchAsync()
    {
        busy = true;
        results = new List<(MemoryDoc, double)>();

        var options = new SearchOptions
        {
            Size = 50
        };
        options.Select.AddRange(new[] { "id", "content", "tags", "externalId" });
        options.SearchFields.AddRange(new[] { "content", "tags", "externalId" });

        var filters = new List<string>();
        if (!string.IsNullOrWhiteSpace(tag))
            filters.Add($"tags/any(t: t eq '{Escape(tag)}')");
        if (!string.IsNullOrWhiteSpace(externalId))
            filters.Add($"externalId eq '{Escape(externalId)}'");

        if (filters.Count > 0)
            options.Filter = string.Join(" and ", filters);

        var q = string.IsNullOrWhiteSpace(query) ? "" : query!;
        var resp = await Search.SearchAsync<MemoryDoc>(q, options);

        await foreach (var r in resp.Value.GetResultsAsync())
        {
            var doc = r.Document!;
            results.Add((doc, r.Score ?? 0));
        }

        busy = false;
    }

    private static string Escape(string s) => s.Replace("'", "''");
}
```

---

## src/LimboDancer.MCP.BlazorConsole/Pages/Graph.razor

```razor
@page "/graph"
@inject IGremlinClientFactory GremlinFactory

<h3>Graph (Cosmos Gremlin)</h3>

<div class="searchpanel">
    <input class="text" @bind="label" placeholder="Vertex label (e.g., ldm:Session)" />
    <button class="btn" @onclick="LoadVerticesAsync">Load Vertices</button>
</div>

@if (loading)
{
    <p>Loading…</p>
}
else
{
    <div class="grid">
        <div class="col">
            <h4>Vertices (label=@label)</h4>
            <table class="grid-table">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Label</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                @if (vertices.Count == 0)
                {
                    <tr><td colspan="3">No vertices.</td></tr>
                }
                else
                {
                    @foreach (var v in vertices)
                    {
                        <tr>
                            <td>@v.Id</td>
                            <td>@v.Label</td>
                            <td><button class="btn small" @onclick="() => LoadOutEdgesAsync(v.Id)">Out-Edges</button></td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>

        <div class="col">
            <h4>Out-Edges (@selectedVertexId)</h4>
            <table class="grid-table">
                <thead>
                    <tr>
                        <th>Edge Label</th>
                        <th>InV Id</th>
                    </tr>
                </thead>
                <tbody>
                @if (edges.Count == 0)
                {
                    <tr><td colspan="2">Select a vertex.</td></tr>
                }
                else
                {
                    @foreach (var e in edges)
                    {
                        <tr>
                            <td>@e.EdgeLabel</td>
                            <td>@e.InVId</td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
}

@code {
    private string? label;
    private bool loading;
    private string? selectedVertexId;

    private List<VertexRow> vertices = new();
    private List<EdgeRow> edges = new();

    private record VertexRow(string Id, string Label);
    private record EdgeRow(string EdgeLabel, string InVId);

    private async Task LoadVerticesAsync()
    {
        loading = true;
        vertices.Clear();
        edges.Clear();
        selectedVertexId = null;

        using var client = GremlinFactory.Create();
        var gremlin = "g.V().hasLabel(lbl).limit(100).project('id','label').by(id()).by(label())";
        var bindings = new Dictionary<string, object?> { ["lbl"] = label ?? "" };
        var rs = await client.SubmitAsync<dynamic>(gremlin, bindings);

        foreach (var row in rs)
        {
            if (row is IDictionary<string, object> map)
            {
                var id = Convert.ToString(map["id"]) ?? "";
                var lbl = Convert.ToString(map["label"]) ?? "";
                vertices.Add(new VertexRow(id, lbl));
            }
        }
        loading = false;
    }

    private async Task LoadOutEdgesAsync(string id)
    {
        selectedVertexId = id;
        edges.Clear();
        using var client = GremlinFactory.Create();

        var gremlin = "g.V(vid).outE().limit(50).project('edgeLabel','inV').by(label()).by(inV().id())";
        var bindings = new Dictionary<string, object?> { ["vid"] = id };
        var rs = await client.SubmitAsync<dynamic>(gremlin, bindings);

        foreach (var row in rs)
        {
            if (row is IDictionary<string, object> map)
            {
                var edgeLabel = Convert.ToString(map["edgeLabel"]) ?? "";
                var inV = Convert.ToString(map["inV"]) ?? "";
                edges.Add(new EdgeRow(edgeLabel, inV));
            }
        }
    }
}
```

---

## src/LimboDancer.MCP.BlazorConsole/Shared/MainLayout.razor

```razor
@inherits LayoutComponentBase

<div class="layout">
    <aside class="sidebar">
        <Shared.NavMenu />
    </aside>
    <main class="content">
        <div class="content-inner">
            @Body
        </div>
        <Shared.Footer />
    </main>
</div>
```

---

## src/LimboDancer.MCP.BlazorConsole/Shared/NavMenu.razor

```razor
<nav>
    <h3 class="brand">LimboDancer</h3>
    <Shared.NavLinkItem Href="/" Text="Home" />
    <Shared.NavLinkItem Href="/sessions" Text="Sessions" />
    <Shared.NavLinkItem Href="/memory" Text="Memory" />
    <Shared.NavLinkItem Href="/graph" Text="Graph" />
</nav>
```

---

## src/LimboDancer.MCP.BlazorConsole/Shared/NavLinkItem.razor

```razor
@using Microsoft.AspNetCore.Components.Routing
<NavLink class="navlink" href="@Href" Match="NavLinkMatch.All">
    @Text
</NavLink>

@code{
    [Parameter] public string Href { get; set; } = "/";
    [Parameter] public string Text { get; set; } = "";
}
```

---

## src/LimboDancer.MCP.BlazorConsole/Shared/Footer.razor

```razor
<footer class="footer">
    <span>Operator Console • Read-only • @DateTime.UtcNow.ToString("u") UTC</span>
</footer>
```

---

## src/LimboDancer.MCP.BlazorConsole/wwwroot/css/site.css

```css
:root { --bg:#0b0d12; --panel:#121520; --text:#e7eaf1; --muted:#9aa3b2; --link:#7aa2ff; --accent:#4cc2a5; --line:#232838; }

* { box-sizing: border-box; }
html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }

a { color: var(--link); text-decoration: none; }
a:hover { text-decoration: underline; }

.layout { display:grid; grid-template-columns:260px 1fr; min-height:100vh; }
.sidebar { background:var(--panel); border-right:1px solid var(--line); padding:16px; }
.brand { margin:0 0 12px 0; font-size:18px; color:var(--accent); }
.navlink { display:block; padding:8px 10px; border-radius:8px; color:var(--text); }
.navlink.active, .navlink:hover { background:#1a2030; }

.content { display:flex; flex-direction:column; }
.content-inner { padding:20px; }

.grid { display:grid; grid-template-columns:1fr 1fr; gap:16px; align-items:start; }
.col { background:#0f1320; padding:12px; border:1px solid var(--line); border-radius:10px; }

.grid-table { width:100%; border-collapse:collapse; font-size:14px; }
.grid-table th, .grid-table td { border-bottom:1px solid var(--line); padding:8px 6px; vertical-align:top; }
.grid-table thead th { color:var(--muted); font-weight:600; }
.rowlink { cursor:pointer; }
.rowlink.active { background:#182036; }

.btn { background:#1e2436; color:var(--text); border:1px solid var(--line); padding:6px 10px; border-radius:8px; cursor:pointer; }
.btn:hover { background:#222a40; }
.btn.small { font-size:12px; padding:4px 8px; }

.text { background:#0e1321; color:var(--text); border:1px solid var(--line); padding:6px 8px; border-radius:8px; width:260px; }
.searchpanel { display:flex; gap:8px; margin-bottom:10px; align-items:center; }

.footer { border-top:1px solid var(--line); color:var(--muted); padding:8px 20px; }
```

---

## How to run (smoke test)

```bash
# From repo root
dotnet run --project src/LimboDancer.MCP.BlazorConsole

# Then visit:
#  - http://localhost:5000/sessions  (lists sessions + messages)
#  - http://localhost:5000/memory    (query Azure AI Search)
#  - http://localhost:5000/graph     (list vertices by label, show out-edges)
```

**Notes**

* The app reads settings from `appsettings.Development.json`. Update `Persistence.ConnectionString`, `Search.Endpoint/ApiKey/Index`, and `CosmosGremlin` values.
* Pages are **read-only** and deliberately simple; they’re meant to verify connectivity and render tables.
* We use `IDbContextFactory<ChatDbContext>` to avoid Blazor Server DbContext threading pitfalls.
* Gremlin page uses `project('id','label')` and `project('edgeLabel','inV')` to keep results easy to render.

If you want filters/paging, or to fold this into your existing **Operator Console scaffold** styling, say the word and I’ll expand this in PR-6.
